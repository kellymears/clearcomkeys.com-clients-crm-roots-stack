"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Env = void 0;
const bud_support_1 = require("@roots/bud-support");
const node_path_1 = require("node:path");
class Env {
    /**
     * Constructor
     *
     * @param baseDirectory -- nearest directory containing package.json from root
     * @returns
     */
    constructor(baseDirectory) {
        const paths = baseDirectory.split('/');
        Object.entries(process.env).map(([k, v]) => (this[k] = v));
        const get = (path) => {
            const { parsed, error } = bud_support_1.dotenv.config({ path });
            if (error || !parsed)
                return;
            const expanded = (0, bud_support_1.dotenvExpand)(parsed);
            if (!expanded)
                return;
            Object.entries(expanded).map(([k, v]) => (this[k] = v));
        };
        paths.reduce((a, c) => {
            const next = (0, node_path_1.join)(a, c);
            get((0, node_path_1.join)(next, '.env'));
            return next;
        }, `/`);
    }
}
exports.Env = Env;
