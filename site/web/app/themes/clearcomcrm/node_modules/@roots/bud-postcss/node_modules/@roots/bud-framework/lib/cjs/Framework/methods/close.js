"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.close = void 0;
const bud_support_1 = require("@roots/bud-support");
/**
 * Exit the program
 *
 * @param callback - Callback function to be called before end of run
 *
 * @public
 */
function close(callback) {
    const ctx = this;
    process.stdin.removeAllListeners();
    if (process.exitCode !== 0) {
        ctx.logger.instance.error(bud_support_1.chalk.red(`\nClearing cache due to non-zero exit code.\n`));
        bud_support_1.fs.removeSync(ctx.path('@storage/cache'));
    }
    process.exitCode === 0
        ? ctx.context.stdout.write(bud_support_1.chalk.green(`\n✔ that's a wrap\n`))
        : ctx.context.stderr.write(bud_support_1.chalk.red(`\n✖ Error\n`));
    ctx.hooks.fire('event.app.close');
    callback ? callback() : process.exit();
}
exports.close = close;
