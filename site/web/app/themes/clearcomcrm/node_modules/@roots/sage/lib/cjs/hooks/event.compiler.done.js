"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bud_support_1 = require("@roots/bud-support");
const fs_extra_1 = require("fs-extra");
const url_1 = require("url");
const { writeJson } = bud_support_1.fs;
/**
 * Event compiler done hook
 *
 * @remarks
 * Generates and emits `hmr.json` with proxy/dev server information
 * for use in Acorn.
 *
 * @public
 */
async function default_1(app) {
    try {
        await (0, fs_extra_1.ensureDir)(app.path('@dist'));
        await writeJson(app.path('@dist', 'hmr.json'), {
            dev: (0, url_1.urlToHttpOptions)(app.hooks.filter('dev.url')) ?? null,
            proxy: (0, url_1.urlToHttpOptions)(app.hooks.filter('middleware.proxy.target')) ??
                null,
            publicPath: app.hooks.filter('build.output.publicPath') ?? null,
        });
    }
    catch (error) {
        app.error(error);
    }
}
exports.default = default_1;
