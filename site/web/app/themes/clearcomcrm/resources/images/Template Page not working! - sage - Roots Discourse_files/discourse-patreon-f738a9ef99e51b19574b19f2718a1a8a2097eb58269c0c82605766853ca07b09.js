define("discourse/plugins/discourse-patreon/discourse/controllers/admin-plugins-patreon",["exports","@ember/controller","I18n","discourse-common/utils/decorators","discourse-common/lib/get-url","discourse/plugins/discourse-patreon/discourse/models/filter-rule","discourse/lib/ajax","discourse/lib/ajax-error","bootbox"],(function(e,t,n,r,a,s,i,o,l){"use strict";var u,d;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c,p,f,m,_,v,g=t.default.extend((u=(0,r.default)("rewards"),d={prettyPrintReward:function(e){return"$".concat(e.amount_cents/100," - ").concat(e.title)},rewardsNames:function(){var e=this;return Object.values(this.rewards).filter((function(e){return e.id>=0})).map((function(t){return e.prettyPrintReward(t)}))},editing:s.default.create({group_id:null}),actions:{save:function(){var e=this,t=this.get("editing"),n=this.get("model");t.set("group",this.groups.find((function(e){return e.id===parseInt(t.get("group_id"),10)}))),t.set("rewards_ids",Object.values(this.rewards).filter((function(n){return t.get("reward_list").includes(e.prettyPrintReward(n))})).map((function(e){return e.id}))),(0,i.ajax)("/patreon/list.json",{method:"POST",data:t.getProperties("group_id","rewards_ids")}).then((function(){var r=n.find((function(e){return e.get("group_id")===t.get("group_id")})),a=t.get("reward_list").filter(Boolean);r?(r.set("reward_list",a),r.set("rewards",a),r.set("rewards_ids",t.rewards_ids)):n.pushObject(s.default.create({group:t.get("group.name"),rewards:a})),e.set("editing",s.default.create({group_id:null}))})).catch(o.popupAjaxError)},delete:function(e){var t=this.get("model");(0,i.ajax)("/patreon/list.json",{method:"DELETE",data:e.getProperties("group_id")}).then((function(){var n=t.find((function(t){return t.get("group_id")===e.get("group_id")}));t.removeObject(n)})).catch(o.popupAjaxError)},updateData:function(){var e=this;this.set("updatingData",!0),(0,i.ajax)("/patreon/update_data.json",{method:"POST"}).catch(o.popupAjaxError).finally((function(){return e.set("updatingData",!1)})),this.messageBus.subscribe("/patreon/background_sync",(function(){e.messageBus.unsubscribe("/patreon/background_sync"),e.set("updatingData",!1),l.default.alert(n.default.t("patreon.refresh_page"),(function(){window.location.pathname=(0,a.default)("/admin/plugins/patreon")}))}))}}},c=d,p="rewardsNames",f=[u],m=Object.getOwnPropertyDescriptor(d,"rewardsNames"),_=d,v={},Object.keys(m).forEach((function(e){v[e]=m[e]})),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=f.slice().reverse().reduce((function(e,t){return t(c,p,e)||e}),v),_&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(_):void 0,v.initializer=void 0),void 0===v.initializer&&(Object.defineProperty(c,p,v),v=null),d));e.default=g})),define("discourse/plugins/discourse-patreon/discourse/initializers/patreon",["exports","discourse/lib/plugin-api"],(function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=0,r="PatreonDonationPromptClosed";function a(e){var t=e.getCurrentUser();e.onAppEvent("page:topic-loaded",(function(e){if(e){var r=e.isPrivateMessage;t&&!r&&n<=e.siteSettings.patreon_donation_prompt_show_after_topics&&n++}})),e.registerConnectorClass("topic-above-footer-buttons","patreon",{shouldRender:function(e,t){return t.currentUser},setupComponent:function(e,t){t.didInsertElement=function(){var e=this.siteSettings.patreon_enabled&&this.siteSettings.patreon_donation_prompt_enabled&&""!==this.siteSettings.patreon_donation_prompt_campaign_url&&this.currentUser.show_donation_prompt&&"t"!==$.cookie(r)&&n>this.siteSettings.patreon_donation_prompt_show_after_topics;this.set("showDonationPrompt",e)}},actions:{close:function(){var e=moment().add(30,"d").toDate();$.cookie(r,"t",{expires:e}),this.$().fadeOut(700)}}})}var s={name:"patreon",initialize:function(){(0,t.withPluginApi)("0.8",a)}};e.default=s})),define("discourse/plugins/discourse-patreon/discourse/models/filter-rule",["exports","discourse/models/rest"],(function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t.default.extend({group_id:-1,reward_list:""});e.default=n})),define("discourse/plugins/discourse-patreon/discourse/patreon-route-map",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("patreon")}}})),define("discourse/plugins/discourse-patreon/discourse/routes/admin-plugins-patreon",["exports","discourse/lib/ajax-error","discourse/models/group","discourse/lib/ajax","discourse/plugins/discourse-patreon/discourse/models/filter-rule","discourse/routes/discourse","rsvp"],(function(e,t,n,r,a,s,i){"use strict";function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=s.default.extend({model:function(){return i.Promise.all([(0,r.ajax)("/patreon/list.json"),n.default.findAll({ignore_automatic:!0})]).then((function(e){var t=o(e,2),n=t[0],r=t[1];return r=r.map((function(e){return{id:e.id,name:e.name}})),{filters:n.filters,rewards:n.rewards,last_sync_at:n.last_sync_at,groups:r}})).catch(t.popupAjaxError)},setupController:function(e,t){var n=t.rewards,r=t.groups,s=Object.entries(t.filters).map((function(e){var t=o(e,2),s=t[0],i=t[1],l=i.map((function(e){return n[e]?" $".concat(n[e].amount_cents/100," - ").concat(n[e].title):""})),u=r.find((function(e){return e.id===parseInt(s,10)}));return a.default.create({group:u.name,rewards:l,group_id:s,reward_ids:i})}));e.setProperties({model:s,groups:r,rewards:n,last_sync_at:t.last_sync_at})}});e.default=u})),Ember.TEMPLATES["javascripts/admin/plugins-patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["rule"],"statements":[[7,"section",true],[10,"id","patreon"],[8],[0,"\\n  "],[7,"h1",true],[8],[1,[28,"i18n",["patreon.header.rules"],null],false],[9],[0,"\\n  "],[7,"table",true],[8],[0,"\\n    "],[7,"thead",true],[8],[0,"\\n      "],[7,"tr",true],[8],[0,"\\n        "],[7,"th",true],[8],[1,[28,"i18n",["patreon.group"],null],false],[9],[0,"\\n        "],[7,"th",true],[8],[1,[28,"i18n",["patreon.rewards"],null],false],[9],[0,"\\n        "],[7,"th",true],[8],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n\\n    "],[7,"tbody",true],[8],[0,"\\n"],[4,"each",[[24,["model"]]],null,{"statements":[[0,"        "],[7,"tr",true],[10,"class",""],[8],[0,"\\n          "],[7,"td",true],[8],[1,[23,1,["group"]],false],[9],[0,"\\n          "],[7,"td",true],[8],[1,[23,1,["rewards"]],false],[9],[0,"\\n          "],[7,"td",true],[8],[0,"\\n            "],[7,"div",true],[10,"class","pull-right"],[8],[0,"\\n              "],[1,[28,"d-button",null,[["action","actionParam","icon","class","title"],["delete",[23,1,[]],"far-trash-alt","delete btn-danger","patreon.delete"]]],false],[0,"\\n            "],[9],[0,"\\n          "],[9],[0,"\\n        "],[9],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n\\n    "],[7,"tfoot",true],[8],[0,"\\n      "],[7,"tr",true],[10,"class","new-filter"],[8],[0,"\\n        "],[7,"td",true],[8],[1,[28,"combo-box",null,[["value","content","nameProperty","valueProperty","none"],[[24,["editing","group_id"]],[24,["groups"]],"name","id","patreon.select_group"]]],false],[9],[0,"\\n        "],[7,"td",true],[8],[1,[28,"list-setting",null,[["value","choices","class"],[[24,["editing","reward_list"]],[24,["rewardsNames"]],"rewards"]]],false],[9],[0,"\\n        "],[7,"td",true],[8],[0,"\\n          "],[7,"div",true],[10,"class","pull-right"],[8],[0,"\\n            "],[1,[28,"d-button",null,[["action","icon","class","title"],["save","check","save btn-primary","patreon.save"]]],false],[0,"\\n          "],[9],[0,"\\n        "],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n\\n  "],[7,"p",true],[8],[1,[28,"i18n",["patreon.help_text"],null],false],[9],[0,"\\n\\n  "],[1,[28,"d-button",null,[["action","icon","class","disabled","title","label"],["updateData","refresh","test",[24,["updatingData"]],"patreon.update_data","patreon.update_data"]]],false],[0,"\\n\\n"],[4,"if",[[24,["last_sync_at"]]],null,{"statements":[[0,"    "],[7,"span",true],[10,"class","last_synced"],[8],[1,[28,"i18n",["patreon.last_synced"],null],false],[0,": "],[1,[28,"html-safe",[[28,"format-date",[[24,["last_sync_at"]]],[["leaveAgo"],["true"]]]],null],false],[9],[0,"\\n"]],"parameters":[]},null],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/admin/plugins-patreon"}}),Ember.TEMPLATES["javascripts/connectors/admin-user-details/patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"section",true],[10,"class","details"],[8],[0,"\\n  "],[7,"h1",true],[8],[1,[28,"i18n",["patreon.title"],null],false],[9],[0,"\\n  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.id"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_id"]],false],[9],[0,"\\n  "],[9],[0,"\\n"],[4,"if",[[24,["model","patreon_email_exists"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n      "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.email"],null],false],[9],[0,"\\n      "],[7,"div",true],[10,"class","value"],[8],[0,"\\n"],[4,"if",[[24,["patreon_email"]]],null,{"statements":[[0,"          "],[1,[22,"patreon_email"],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"          "],[1,[28,"d-button",null,[["class","action","actionParam","icon","label","title"],["btn-default","checkPatreonEmail",[24,["model"]],"far-envelope","admin.users.check_email.text","admin.users.check_email.title"]]],false],[0,"\\n"]],"parameters":[]}],[0,"      "],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_amount_cents"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n      "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.amount_cents"],null],false],[9],[0,"\\n      "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_amount_cents"]],false],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_rewards"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n      "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.rewards"],null],false],[9],[0,"\\n      "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_rewards"]],false],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_declined_since"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n      "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.declined_since"],null],false],[9],[0,"\\n      "],[7,"div",true],[10,"class","value"],[8],[1,[28,"html-safe",[[24,["format-date"]],[24,["model","patreon_declined_since"]]],null],false],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.more_details.label"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[0,"\\n      "],[7,"a",true],[10,"rel","noopener noreferrer"],[10,"target","_blank"],[11,"href",[22,"patron_url"]],[8],[0,"\\n        "],[1,[28,"d-icon",["external-link-alt"],null],false],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n"],[4,"if",[[24,["model","patreon_email"]]],null,{"statements":[[0,"        "],[1,[28,"i18n",["patreon.field.more_details.help_text.email_available"],null],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        "],[1,[28,"i18n",["patreon.field.more_details.help_text.email_not_available"],null],false],[0,"\\n"]],"parameters":[]}],[0,"    "],[9],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/admin-user-details/patreon"}}),define("discourse/plugins/discourse-patreon/discourse/templates/connectors/admin-user-details/patreon",["exports","discourse/lib/ajax","discourse/lib/url"],(function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={shouldRender:function(e,t){return t.args.patron_url="https://patreon.com/members",t.siteSettings.patreon_enabled&&e.model.patreon_id},actions:{checkPatreonEmail:function(e){var r=this;(0,t.ajax)((0,n.userPath)("".concat(e.username_lower,"/patreon_email.json")),{data:{context:window.location.pathname}}).then((function(e){if(e){var t=e.email,n="https://patreon.com/members";t&&(n="".concat(n,"?query=").concat(t)),r.set("patreon_email",t),r.set("patron_url",n)}}))}}};e.default=r})),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["showDonationPrompt"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","patreon-donation-prompt"],[8],[0,"\\n    "],[7,"span",false],[12,"role","button"],[12,"class","close"],[3,"action",[[23,0,[]],"close"]],[8],[0,"\\n      "],[1,[28,"d-icon",["times"],null],false],[0,"\\n    "],[9],[0,"\\n\\n    "],[1,[28,"html-safe",[[28,"i18n",["patreon.donation_prompt.body"],[["campaignUrl"],[[24,["siteSettings","patreon_donation_prompt_campaign_url"]]]]]],null],false],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/topic-above-footer-buttons/patreon"}});
//# sourceMappingURL=discourse-patreon-f738a9ef99e51b19574b19f2718a1a8a2097eb58269c0c82605766853ca07b09.js.map